<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    * {
        margin: 0;
        padding: 0;
    }
    li {
        list-style: none;
    }
    .wrap {
        width: 300px;
        height: 100px;
        margin: 60px auto 0;
        position: relative;
        overflow: hidden;
    }

    .con {
        position: absolute;
        left: -100%;
        width: 500%;
        height: 100%;
    }
    .con li {
        width: 20%;
        height: 100px;
        line-height: 100px;
        float: left;
        color: #fff;
        font-size: 60px;
        text-align: center;
    }
    .con li.first {
        background-color: red;
    }
    .con li.second {
        background-color: green;
    }
    .con li.thrid {
        background-color: blue;
    }
    .con li.four {
        background-color: pink;
    }
    .dot{
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
    }
    .dot li {
        display: inline-block;
        width: 4px;
        height: 4px;
        border-radius: 2px;
        cursor: pointer;
        background-color: rgba(255, 255, 255, .3);
        margin: 0 5px;
        transition: all .3s;
    }
    .dot .active {
        width: 15px;
        background-color: rgba(255, 255, 255, 1);
    }
    </style>
</head>
<body>
    <div class="wrap">
        <ul class="con">
            <li class="first">1</li>
            <li class="second">2</li>
            <li class="thrid">3</li>
        </ul>
        <ol class="dot">
            <li class="active"></li>
            <li></li>
            <li></li>
        </ol>
    </div>
    <script src="./animate.js"></script>
    <script>
    var oWrap = document.querySelector('.wrap');
    var oUl = document.querySelector('ul');
    
    // å‰åå„è¡¥ä¸€å¼ 
    oUl.appendChild( oUl.children[0].cloneNode(true) );
    oUl.insertBefore( oUl.children[oUl.children.length - 2].cloneNode(true), oUl.children[0] );
    
    var aUlLis = oUl.getElementsByTagName('li');

    var oOl = document.querySelector('ol');
    var aOlLis = oOl.getElementsByTagName('li');

    var oneWid = aUlLis[0].offsetWidth;
    
    var timer = null;
    var iNow = 0;
    timer = setInterval(() => {
        iNow ++;
        oUl.style.transition = 'all .3s';
        oUl.style.transform = 'translateX('+ -iNow * oneWid +'px)';
    }, 2000);

    // ç­‰è¿‡åº¦å®Œæˆä¹‹åå†åˆ¤æ–­ğŸ˜Š
    oUl.addEventListener('transitionend', function() {
        // >=
        if(iNow >= 3) {
            iNow = 0;
            oUl.style.transition = 'none';
            // è¿™é‡Œ translateX(0px) æ˜¯é»˜è®¤çš„å€¼ï¼Œå³è¿˜æ˜¯ç¬¬ä¸€å¼ ï¼Œå¹¶ä¸æ˜¯ 1 å·¦è¾¹çš„ 3
            // æ˜¾ç¤ºä»3è¿åŠ¨åˆ°æœ€åä¸€å¼ 1ï¼Œæœ€åä¸€å¼ 1è¿åŠ¨å®Œåç¬é—´è·³åˆ°1
            // è€ŒPCç«¯æ˜¯ä¸‹æ¬¡è¿åŠ¨æ—¶åˆ‡æ¢çš„åˆå§‹ï¼Œç§»åŠ¨ç«¯æ˜¯æœ€åä¾æ¬¡è¿åŠ¨å®Œååˆ‡æ¢çš„åˆå§‹
            var translateX = -iNow * oneWid;
            oUl.style.transform = 'translateX('+ translateX +'px)';
            // clearInterval(timer);
        } else if(iNow < 0) {
            // iNow ç­‰äº 0 æ—¶æ˜¯ç¬¬ä¸€å¼ å›¾
            // iNow ç­‰äº 2 æ—¶æ˜¯ç¬¬ä¸‰å¼ å›¾
            iNow = 2;
            oUl.style.transition = 'none';
            var translateX = -iNow * oneWid;
            oUl.style.transform = 'translateX('+ translateX +'px)';
        }

        // å°åœ†ç‚¹è·Ÿéšå˜åŒ–
        oOl.querySelector('.active').classList.remove('active');
        oOl.children[iNow].classList.add('active');
    });


    // æ‰‹æŒ‡æ»‘åŠ¨
    var startX = 0;
    var moveX = 0;
    var flag = false;
    oUl.addEventListener('touchstart', function(e) {
        startX = e.targetTouches[0].pageX;

        // æ‰‹æŒ‡è§¦æ‘¸çš„æ—¶å€™å°±åœæ­¢å®šæ—¶å™¨ï¼Œä¸ç„¶ä¸€è¾¹æ‹–ç€è·‘ä¸€è¾¹å®šæ—¶å™¨ä¹Ÿè·‘
        clearInterval(timer);
    });
    oUl.addEventListener('touchmove', function(e) {
        // è®¡ç®—ç§»åŠ¨è·ç¦»
        moveX = e.targetTouches[0].pageX - startX;

        // ç›’å­åŸæ¥çš„ä½ç½® + æ‰‹æŒ‡ç§»åŠ¨çš„è·ç¦»
        var translateX = - iNow * oneWid + moveX;

        // æ‰‹æŒ‡æ‹–åŠ¨çš„æ—¶å€™ä¸éœ€è¦åŠ¨ç”»ï¼Œéœ€è¦å»æ‰è¿‡åº¦
        oUl.style.transition = 'none';
        oUl.style.transform = 'translateX('+ translateX +'px)';

        // è¯æ˜ç§»åŠ¨äº†
        flag = true;

        // å¦‚æœæœ‰å¤šå±ï¼Œä¼šæœ‰é»˜è®¤çš„æ»šåŠ¨è¡Œä¸ºï¼Œéœ€è¦é˜»æ­¢ğŸ¤«
        e.preventDefault();
    });

    oUl.addEventListener('touchend', function() {
        if(flag) {
            if(Math.abs(moveX) > 50) {
                // å¦‚æœæ˜¯å³æ»‘ï¼ŒmoveXæ˜¯æ­£å€¼ï¼Œå°±æ’­æ”¾ä¸Šä¸€å¼ 
                if(moveX > 0) {
                    iNow --;
                } else {
                    iNow ++;
                }

                var translateX = - iNow * oneWid;
                // å› ä¸º touchmove çš„æ—¶å€™å»æ‰äº†è¿‡åº¦ï¼Œè¿™é‡Œéœ€è¦å†åŠ ä¸Š
                oUl.style.transition = 'all .3s';
                oUl.style.transform = 'translateX('+ translateX +'px)';
            } else {
                var translateX = - iNow * oneWid;
                oUl.style.transition = 'all .3s';
                oUl.style.transform = 'translateX('+ translateX +'px)';
            }
        }

        // æ‰‹æŒ‡ç¦»å¼€å¼€å¯å®šæ—¶å™¨
        clearInterval(timer);
        timer = setInterval(() => {
            iNow ++;
            oUl.style.transition = 'all .3s';
            oUl.style.transform = 'translateX('+ -iNow * oneWid +'px)';
        }, 2000);
    });
    </script>
</body>
</html>